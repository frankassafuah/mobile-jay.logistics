<!DOCTYPE HTML>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>Jay Logistic Mobile</title>
<link rel="stylesheet" type="text/css" href="styles/style.css">
<link rel="stylesheet" type="text/css" href="styles/framework.css">
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,500,500i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,700,700i,900,900i" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="fonts/css/fontawesome-all.min.css">  
<link rel="apple-touch-icon" sizes="180x180" href="images/logo.png">

</head>
<style>
.color-highlight {
    color: #dc8e3f!important;
}
.input-style-1.has-icon .input-style-1-active {
    color: #dd9247!important;
    transform: translateX(-25px);
    transition: all 150ms ease;
}
.bg-green1-dark {
    background-color: #dc8e3f!important;
    color: #dc8e3f!important;
}
m.round-small.shadow-huge.bg-orange1-dark.bottom-30 {
    background-color: #dc8e3f!important;
    color: #dc8e3f!important;
}
.button {
    background: #334dadeb;
}
h2.font-16.under-heading.color-highlight.bold {
    color: orange!important;
}

/* STYLES */
#banner{
    background: url('images/header.png');
    top: 0;
    height: 390px;
    margin: -15px -15px -15px -20px;
    background-repeat: no-repeat;
}

/*iphone 5 and small phones */
@media only screen and (max-device-width : 320px) { 
            #banner{
            background: url('images/header.png');
            top: 0;
            left: 0;
            height: 390px;
            margin: -15px -15px -15px -15px;
            background-repeat: no-repeat;
			background-size: contain;
        }
} 

@media only screen and (min-device-width : 321px) and (max-device-width : 568px) { 
            #banner{
            background: url('images/header.png');
            top: 0;
            left: 0;
            height: 390px;
            margin: -15px -15px -15px -15px;
            background-repeat: no-repeat;
			background-size: contain;
        }
} 

/*ipad and tablets */
@media only screen and (min-device-width : 768px) and (max-device-width : 1024px) { 
            #banner {
				background: url(images/header.png);
				top: 0;
				left: 0;
				height: 560px;
				margin: -35px 0px 10px -10px;
				background-repeat: no-repeat;
				width: 105%;
				background-size: cover;
			}
} 

@media only screen and (min-device-width : 1024px) { 
        #banner {
			background: url(images/header.png);
			top: 0;
			left: 0;
			height: 560px;
			margin: 0px 42px -29px 0px;
			background-repeat: no-repeat;
			width: 105%;
		}
} 

/* page content */
.page-content {
    z-index: 95;
    /*background-color: #f2f2f2;*/
    overflow-x: hidden;
    box-shadow: 0 0px 25px 13px rgba(0,0,0,0.08);
}
.header-clear-large {
    padding-top: 0px;
}
.page-content.header-clear-large {
    min-height: 300px!important;
}
.input-style-1.has-icon .input-style-1-active {
    color: #dd9247!important;
    transform: translateX(-25px);
    transition: all 150ms ease;
    background: transparent;
}
#AjaxLoader {
	height: 100vh;width: 100vw;position: fixed;z-index: 99;background: #ffffff82;display:none
}
#AjaxLoader img {
	margin: auto auto;width: 10%;position: fixed;top: 50%;left: 45%;
}
</style>
<body class="theme-light" data-highlight="blue2">
        
<div id="page">
<div id="AjaxLoader">
    <img src="images/AjaxLoader.gif" data-src="images/AjaxLoader.gif">
</div>

    
    <div id="page-preloader">
        <div class="loader-main"><div class="preload-spinner border-highlight"></div></div>
    </div>
	
	<div class="header header-fixed header-logo-app">
		<a href="page-profile.html" class="back-button header-title">Back to pages</a>
		<a href="page-profile.html" class="header-icon header-icon-1 back-button"><i class="fas fa-arrow-left"></i></a>
        <a href="#" class="header-icon header-icon-3" data-menu="menu-navigation"><i class="fas fa-bars"></i></a>
	</div>
    
    <div class="page-content header-clear-large">           
    <div id="banner"></div>
	
        <div class="profile-header">
            <div class="profile-left">
                <h1>Order Details</i></h1>
                <p id="profile_number">
                    Jay Logistic
                </p>
                            
                <div class="clear"></div>
            </div>
            <div class="profile-right">
                
            </div>
        </div>

        <div class="content bottom-0">
            <div class="one-half">
                <a href="page-profile.html" class="button button-full button-m round-small shadow-huge bg-orange1-dark bottom-30">Back</a>
            </div>
            <div class="one-half last-column">
                <a href="page-book.html" class="button button-full button-m round-small shadow-huge bg-orange2-dark bottom-30">Book Dispatch</a>
            </div>
            <div class="clear"></div>
        </div>
		
        <div class="content bottom-20">
            <div class="gallery-views gallery-view-3" id="order_details_html">
                
				<!-- start -->
				
	
	
				<!-- end -->
				
            </div>
			
				<!-- MAP -->
			<div  id="map-canvas" style="width:100%;height:400px;min-height:250px;"></div>
			
            <div class="clear"></div>
        </div>
		

        <div class="divider divider-margins"></div>                
    </div>

    
	<div id="menu-navigation"
         class="menu-box menu-transparent"
         data-menu-type="menu-box-left"
         data-menu-width="260"
         data-menu-selected="nav-page-pages"
         data-menu-load="menu-navigation.html"
         data-menu-effect="menu-reveal">
    </div>    
		
    <div class="menu-hider"></div>
</div>

<script type="text/javascript" charset="utf-8" src="cordova.js"></script> 
<script type="text/javascript" src="scripts/jquery.js"></script>
<script type="text/javascript" src="scripts/plugins.js"></script>
<script type="text/javascript" src="scripts/custom.js" async></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjxuVLaH1LrBs1wh4O5_XINbK8CbXG5LI&libraries=places&callback=" async defer></script>
<script>
	document.addEventListener("deviceready", onDeviceReady, false);
	document.addEventListener("deviceready", initMap, false);
    // Cordova is ready
	
	function purgeData(){
		window.localStorage.setItem('JayLogisticGen', '');
		window.localStorage.setItem('JayLogisticStat', 0);
	}
	
	// VARIABLES HERE
    var logged_in_number;
	var ajax_base = "https://jaylogistic.com/api/integration/v1/index.php/";
	var profile_url = ajax_base + "manager/profile";
	var search_url = ajax_base + "search/orderDetailsById";
	var search_id;
	var from_location,to_location,rider,riderLoc,item_from,item_to,markerA,markerB,markerC,driver_lat,driver_lang,delivery_status;
	var icon = "https://jaylogistic.com/api/integration/v1/assets/motorcycle-2.png";
	
    function onDeviceReady() {
		var logged_in_stat = localStorage.getItem('JayLogisticStat');
		var logged_in_number = localStorage.getItem('JayLogisticGen');
		
		if(logged_in_stat == 1){ 
			console.log('Logged In');
			
			profile(logged_in_number); 
			search_id = get('id'); 
			userOrders(search_id);
		} 
		
		if(logged_in_stat == 0 || logged_in_number==undefined || logged_in_number===null || logged_in_number===''){
			purgeData();
			console.log('Not Logged In');				
		}
		
    }
	
	function profile(logged_in_number){
		if (logged_in_number) {
			$.ajax({
			  url: profile_url,
			  method: "POST",
			  dataType: 'json',
			  cache   : false,
			  data: { number: logged_in_number},
			}).done(function(res) {
				//console.log(res);
					
			}).fail(function( jqXHR, textStatus ) {
			   alert('Something went wrong, please try again.');
			   
			});
		} else {
			alert('Something went wrong, please try again.');
		}	
	}
	
	function get(name){
		if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
		return decodeURIComponent(name[1]);
	}

	function userOrders(search_id){
		if (search_id) {	
			$.ajax({
			  url: search_url,
			  method: "POST",
			  dataType: 'json',
			  cache   : false,
			  data: { search_id:search_id},
			}).done(function(res) {
				console.log(res);
				//IF SUCCESSFUL
				item = res;				
				
				if(item.bid_amount == null) {
					item.bid_amount = 0.00;
				}
				
				if(item.signature == null) {
					item.signature = "N/A";
				}
				
				order_details_html =  "<a href='page-order.html?id=" + item.booking_id +"' class='default-link' title='Order'>";
				order_details_html += "<img src='images/empty.png' data-src='images/pictures/10t.jpg' class='preload-image round-small shadow-huge responsive-image' alt='img'>";
				order_details_html += "<div class='caption'>";
				order_details_html += "<h4 class='bottom-0 color-theme'>Delivery to "+ item.to_location +"</h4>";
				
				order_details_html += "<p>";
				order_details_html += "<strong>Price: GBP " + item.price + "</strong><br>";
				order_details_html += "Bid Amount: GBP " + item.bid_amount + "<br>";
				order_details_html += "Category: " + item.category + "<br>";
				order_details_html += "Distance: " + item.distance + "<br>";
				order_details_html += "Creation Date: " + item.date_created + "<br>";
				order_details_html += "Delivery Date: " + item.date + "<br>";
				
				order_details_html += "<br>"
				order_details_html += "Reference Number: 1000" + item.id + "<br>";
				order_details_html += "Pickup Address: " + item.from_location + "<br>";
				order_details_html += "Delivery Address: " + item.to_location + "<br>";
				order_details_html += "Floor Pickup: " + item.floor_pickup + "<br>";
				order_details_html += "Floor Delivery: " + item.floor_deliver + "<br>";
				order_details_html += "Men Needed: " + item.hire_men + "<br>";
				//order_details_html += "Delivery Status: " + "<br>";
				
				order_details_html += "<br>"
				order_details_html += "Signature: " + item.signature + "<br>";
				order_details_html += "</p>";
				
				order_details_html += "<div class='divider bottom-0'></div>";
				order_details_html += "</div>";
				order_details_html += "</a>";
				
				$("#order_details_html").append(order_details_html);
				item_from = item.from_location;
				item_to = item.to_location;
				
				
				/*driver_lat = item.driver_location_lat;
				driver_lang = item.driver_location_lang;
				delivery_status = item.delivery_status
				
				if(delivery_status == "successful" || delivery_status == "unassigned" || delivery_status == ""){
					driver_lat = "";
					driver_lang = "";
				}*/
				initMap(item.from_location, item.to_location);
				
			}).fail(function( jqXHR, textStatus ) {
			   alert('Something went wrong, please try again.');
			   
			});
		} else {
			alert('Something went wrong, please try again.');
		}	
		
	}

	function initMap(from_location,to_location) {
		var pointA = from_location,
			pointB = to_location,
			/*riderLoc = {
				lat: driver_lat,
				lng: driver_lang	
			},*/
			
			myOptions = {
				zoom: 9,
				center: pointA
			},
			map = new google.maps.Map(document.getElementById('map-canvas'), myOptions),
			// Instantiate a directions service.
			directionsService = new google.maps.DirectionsService,
			directionsDisplay = new google.maps.DirectionsRenderer({
				map: map
			}),
			markerA = new google.maps.Marker({
				position: pointA,
				title: "point A",
				label: "From",
				map: map
			}),
			markerB = new google.maps.Marker({
				position: pointB,
				title: "point B",
				label: "To",
				map: map
			})
			/*markerC = new google.maps.Marker({
				position: riderLoc,
				animation: google.maps.Animation.DROP,
				title: "Rider",
				label: "",
				icon: icon,
				map: map
			})*/
			;


		// get route from A to B
		calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB);

	}

	function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB) {
		directionsService.route({
			origin: pointA,
			destination: pointB,
			avoidTolls: true,
			avoidHighways: false,
			travelMode: google.maps.TravelMode.DRIVING
		}, function (response, status) {
			if (status == google.maps.DirectionsStatus.OK) {
				directionsDisplay.setDirections(response);
			} else {
				window.alert('Directions request failed due to ' + status);
			}
		});
	}

	/*setInterval(function updateMap(item_from, item_to){
		
		//initMap(item_from,item_to);

	}, 10000);*/
	
    
</script>
</body>
