<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Content-Security-Policy" content="default-src * gap:; style-src * 'unsafe-inline' 'unsafe-eval'; media-src *; img-src * data:; script-src * 'unsafe-inline' 'unsafe-eval'; ">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
	<title>Jay Logistic Mobile</title>
	<link rel="stylesheet" type="text/css" href="styles/style.css">
	<link rel="stylesheet" type="text/css" href="styles/framework.css">
	<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,500,500i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,700,700i,900,900i" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="fonts/css/fontawesome-all.min.css">
	<link rel="apple-touch-icon" sizes="180x180" href="images/logo.png">
	<style>
		.color-highlight {
			color: #dc8e3f !important;
		}

		.input-style-1.has-icon .input-style-1-active {
			color: #dd9247 !important;
			transform: translateX(-25px);
			transition: all 150ms ease;
		}

		.bg-green1-dark {
			background-color: #dc8e3f !important;
			color: #dc8e3f !important;
		}

		m.round-small.shadow-huge.bg-orange1-dark.bottom-30 {
			background-color: #dc8e3f !important;
			color: #dc8e3f !important;
		}

		.button {
			background: #334dadeb;
		}

		h2.font-16.under-heading.color-highlight.bold {
			color: orange !important;
		}

		/* STYLES */
		#banner {
			background: url('images/header.png');
			top: 0;
			height: 390px;
			margin: -15px -15px -15px -20px;
			background-repeat: no-repeat;
		}

		/*iphone 5 and small phones */
		@media only screen and (max-device-width : 320px) {
			#banner {
				background: url('images/header.png');
				top: 0;
				left: 0;
				height: 390px;
				margin: -15px -15px -15px -15px;
				background-repeat: no-repeat;
				background-size: contain;
			}
		}

		@media only screen and (min-device-width : 321px) and (max-device-width : 568px) {
			#banner {
				background: url('images/header.png');
				top: 0;
				left: 0;
				height: 390px;
				margin: -15px -15px -15px -15px;
				background-repeat: no-repeat;
				background-size: contain;
			}
		}

		/*ipad and tablets */
		@media only screen and (min-device-width : 768px) and (max-device-width : 1024px) {
			#banner {
				background: url(images/header.png);
				top: 0;
				left: 0;
				height: 560px;
				margin: -35px 0px 10px -10px;
				background-repeat: no-repeat;
				width: 105%;
				background-size: cover;
			}
		}

		@media only screen and (min-device-width : 1024px) {
			#banner {
				background: url(images/header.png);
				top: 0;
				left: 0;
				height: 560px;
				margin: 0px 42px -29px 0px;
				background-repeat: no-repeat;
				width: 105%;
			}
		}

		/* page content */
		.page-content {
			z-index: 95;
			/*background-color: #f2f2f2;*/
			overflow-x: hidden;
			box-shadow: 0 0px 25px 13px rgba(0,0,0,0.08);
		}

		.header-clear-large {
			padding-top: 0px;
		}

		.page-content.header-clear-large {
			min-height: 300px !important;
		}

		.input-style-1.has-icon .input-style-1-active {
			color: #dd9247 !important;
			transform: translateX(-25px);
			transition: all 150ms ease;
			background: transparent;
		}

		#AjaxLoader {
			height: 100vh;
			width: 100vw;
			position: fixed;
			z-index: 99;
			background: #ffffff82;
			display: none
		}

			#AjaxLoader img {
				margin: auto auto;
				width: 10%;
				position: fixed;
				top: 50%;
				left: 45%;
			}

		h1#profile_name {
			margin-top: 5%;
		}

		.gallery-view-3 .caption {
			padding-top: 20px;
			border-radius: 10px;
			padding: 10px;
		}
	</style>
</head>

<body class="theme-light" data-highlight="blue2">

	<div id="page">
		<div id="AjaxLoader">
			<img src="images/AjaxLoader.gif" data-src="images/AjaxLoader.gif">
		</div>

		<div id="page-preloader">
			<div class="loader-main"><div class="preload-spinner border-highlight"></div></div>
		</div>

		<div class="header header-fixed header-logo-app">
			<a href="main.html" class="back-button header-title">Back to pages</a>
			<a href="main.html" class="header-icon header-icon-1 back-button"><i class="fas fa-arrow-left"></i></a>
			<a href="#" class="header-icon header-icon-3" data-menu="menu-navigation"><i class="fas fa-bars"></i></a>
		</div>

		<div class="page-content header-clear-large">
			<div id="banner"></div>


			<div class="profile-header">
				<div class="profile-left">
					<h1 id="profile_name"> <i class="fa fa-check-circle color-highlight"></i></h1>
					<p id="profile_number">

					</p>
					<a href="#" class="color-theme"><span id="profile_join_date"> </span> <span> Joined</span></a>

					<br>
					<p id="profile_user_type">

					</p>
					<div class="clear"></div>
				</div>
				<div class="profile-right">
					<a href="#">
						<img id="profile-picture" src="images/empty.png" data-src="images/pictures/0s.png" class="preload-image shadow-large">
					</a>
				</div>
			</div>

			<form id="profile_edit_form">
				<div class="content bottom-100" style="display:none" id="profile_edit_div">
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-user font-11"></i>
						<span>First Name</span>
						<em>(required)</em>
						<input type="text" placeholder="First Name" name="profile_edit_first_name" id="profile_edit_first_name" required>
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-user font-11"></i>
						<span>Last Name</span>
						<em>(required)</em>
						<input type="text" placeholder="Last Name" name="profile_edit_last_name" id="profile_edit_last_name">
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-envelope font-11"></i>
						<span>Email</span>
						<em>(required)</em>
						<input type="text" placeholder="Email" name="profile_edit_email" id="profile_edit_email">
					</div>
					
					<input type="hidden" placeholder="Phone Number" name="profile_edit_phone" id="profile_edit_phone" >
					
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-map font-11"></i>
						<span>Address</span>
						<em></em>
						<input type="text" placeholder="Address" name="profile_edit_address" id="profile_edit_address" >
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-map font-11"></i>
						<span>Town/City</span>
						<em></em>
						<input type="text" placeholder="Town/City" name="profile_edit_town" id="profile_edit_town" >
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-map font-11"></i>
						<span>Region</span>
						<em></em>
						<input type="text" placeholder="Region" name="profile_edit_region" id="profile_edit_region" >
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-map font-11"></i>
						<span>Country</span>
						<em></em>
						<input type="text" placeholder="Country" name="profile_edit_country" id="profile_edit_country" >
					</div>

					<!-- BUSINESS -->
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-pen font-11"></i>
						<span>Business Name</span>
						<em></em>
						<input type="text" placeholder="Business Name" name="profile_edit_business_name" id="profile_edit_business_name" >
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-pen font-11"></i>
						<span>Business Description</span>
						<em></em>
						<input type="text" placeholder="Business Description" name="profile_edit_business_description" id="profile_edit_business_description" >
					</div>

					<!-- BANK ACCOUNT -->
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-bank font-11">&#xf0d6;</i>
						<span>Bank Name</span>
						<em></em>
						<input type="text" placeholder="Bank Name" name="profile_edit_bank_name" id="profile_edit_bank_name" >
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-bank font-11">&#xf0d6;</i>
						<span>Bank Account Name</span>
						<em></em>
						<input type="text" placeholder="Bank Account Name" name="profile_edit_bank_account_name" id="profile_edit_bank_account_name" >
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-bank font-11">&#xf0d6;</i>
						<span>Bank Account Number</span>
						<em></em>
						<input type="text" placeholder="Bank Account Number" name="profile_edit_bank_account_number" id="profile_edit_bank_account_number" >
					</div>
					<div class="input-style has-icon input-style-1 input-required top-50">
						<i class="input-icon fa fa-bank font-11">&#xf0d6;</i>
						<span>Sort Code</span>
						<em></em>
						<input type="text" placeholder="Sort Code" name="profile_edit_sort_code" id="profile_edit_sort_code" >
					</div>

					<!--<div class="input-style has-icon input-style-1 input-required top-50">
							<i class="input-icon fa fa-user font-11"></i>
							<span>Photo</span>
							<em>(Optional)</em>
							<input type="file" id="profile_edit_photo">
					</div>-->

					<div class="one-half">
						<a href="#" id="profile_edit_save_button" class="button button-full button-m round-small shadow-huge bg-orange1-dark bottom-30">SAVE CHANGES</a>
					</div>
					<div class="one-half last-column">
						<a href="#" id="profile_edit_cancel_button" class="button button-full button-m round-small shadow-huge bg-orange1-dark bottom-30">CANCEL</a>
					</div>
				</div>
			</form>

			<div class="content bottom-0" id="profile_main_div_buttons">
				<div class="one-half">
					<a href="page-book.html" class="button button-full button-m round-small shadow-huge bg-orange1-dark bottom-30">New Booking</a>
				</div>
				<div class="one-half last-column">
					<a href="#" id="profile_edit_button" class="button button-full button-m round-small shadow-huge bg-orange2-dark bottom-30">Edit Details</a>
				</div>

				<div class="clear"></div>

				<div class="one-half">
					<a href="#" id="profile_accepted_jobs_button" class="button button-full button-m round-small shadow-huge bg-orange2-dark bottom-30" onClick="acceptedJobs()" style="display:none">Accepted Jobs</a>
				</div>

				<div class="clear"></div>
			</div>

			<div class="divider divider-margins bottom-0"></div>

			<div class="content bottom-30" id="driver_main_div" style="display:none">
				<div class="gallery-views gallery-view-3" id="driver_html">
					<!-- driver div start -->
					<!-- driver div end -->

				</div>
				<div class="clear"></div>
			</div>
			<div class="content bottom-30" id="driver_secondary_div" style="display:none">
				<div class="gallery-views gallery-view-3" id="driver_secondary_html">
					<!-- driver SECONDARY div start -->
					<!-- driver SECONDARY div end -->

				</div>
				<div class="clear"></div>
			</div>


			<div class="content bottom-30" id="profile_main_div" style="display:none">
				<div class="gallery-views gallery-view-3" id="order_html">
					<!-- user div start -->
					<!-- user div end -->

				</div>
				<div class="clear"></div>
			</div>


			<div class="divider divider-margins"></div>
		</div>


		<div id="menu-navigation"
			 class="menu-box menu-transparent"
			 data-menu-type="menu-box-left"
			 data-menu-width="260"
			 data-menu-selected="nav-page-pages"
			 data-menu-load="menu-navigation.html"
			 data-menu-effect="menu-reveal">
		</div>

		<div class="menu-hider"></div>
	</div>

	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script type="text/javascript" src="scripts/jquery.js"></script>
	<script type="text/javascript" src="scripts/plugins.js"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<script type="text/javascript" src="scripts/custom.js?V=1" async></script>
	<script>
		document.addEventListener("deviceready", onDeviceReady, false);
		// Cordova is ready

		const unixTime = Math.floor(Date.now() / 1000);
		var logged_in_number;
		var image_base = "https://jaylogistic.com/app/uploads/profile/";
		var ajax_base = "https://jaylogistic.com/api/integration/v1/index.php/";
		var profile_url = ajax_base + "manager/profile";
		var orders_url = ajax_base + "search/ordersByNumber";
		var my_accepted_orders_url = ajax_base + "search/acceptedOrdersByNumber";
		var new_orders_url = ajax_base + "search/newOrders";
		var profile_edit_url = ajax_base + "manager/profileEdit";

		function purgeData() {
			window.localStorage.setItem('JayLogisticGen', '');
			window.localStorage.setItem('JayLogisticStat', 0);
		}

		function onDeviceReady() {
			var logged_in_stat = localStorage.getItem('JayLogisticStat');
			var logged_in_number = localStorage.getItem('JayLogisticGen');

			if (logged_in_stat == 1) {
				//console.log('Logged In');
				profile(logged_in_number); userOrders(logged_in_number);
			}

			if (logged_in_stat == 0 || logged_in_number == undefined || logged_in_number === null || logged_in_number === '') {
				purgeData();
				window.location.href = "page-login-2.html";
				//console.log('Not Logged In');
			}

		}

		function profile(logged_in_number) {
			if (logged_in_number) {
				$.ajax({
					url: profile_url,
					method: "POST",
					dataType: 'json',
					cache: false,
					data: { number: logged_in_number },
				}).done(function (res) {
					//console.log(res);
					//populate user type
					localStorage.setItem('JayLogisticUT', res.usr.user_type);
					//IF SUCCESSFUL
					if (res.stat == 1) {
						$('#profile_name').html(res.usr.first_name + " " + res.usr.last_name);
						$('#profile_number').html(res.usr.contact_phone);
						$('#profile_join_date').html(res.usr.created_on_formatted);
						$('#profile_user_type').html(res.usr.user_type);

						if (res.usr.picture != null) {
							$('#profile_picture').attr('src', image_base + res.usr.picture);
							$('#profile_picture').attr('data-src', image_base + res.usr.picture);
						}
						//POPULATE EDIT DIVS

						$('#profile_edit_first_name').val(res.usr.first_name);
						$('#profile_edit_last_name').val(res.usr.last_name);
						$('#profile_edit_email').val(res.usr.email);
						$('#profile_edit_phone').val(res.usr.phone);
						$('#profile_edit_address').val(res.usr.address1 + ', ' + res.usr.address2);
						$('#profile_edit_town').val(res.usr.city);
						$('#profile_edit_region').val(res.usr.region);
						$('#profile_edit_country').val(res.usr.country);
						$('#profile_edit_business_name').val(res.usr.company);
						$('#profile_edit_business_description').val(res.usr.company_description);
						$('#profile_edit_bank_name').val(res.usr.bank_name);
						$('#profile_edit_bank_account_name').val(res.usr.bank_acc_name);
						$('#profile_edit_bank_account_number').val(res.usr.bank_acc_number);
						$('#profile_edit_sort_code').val(res.usr.bank_sort_code);

						//CHECK IF DRIVER
						if (res.usr.user_type == 'Driver') {
							newOrders(logged_in_number);
							$("#profile_accepted_jobs_button").show();
						}

						if (res.usr.user_type == 'User') {
							$("#profile_main_div").show();
						}
					}

				}).fail(function (jqXHR, textStatus) {
					swal('Something went wrong, please try again.');

				});
			} else {
				swal('Something went wrong, please try again.');
			}
		}
		
	    $( "#profile_edit_save_button" ).on( "click", function() {
    	    profileEdit();
    	});
    	
    	function profileEdit(){
    	    logged_in_number = localStorage.getItem('JayLogisticGen');
			$('#AjaxLoader').show();
			$.ajax({
			  url: profile_edit_url + "/" + logged_in_number,
			  method: "POST",
			  dataType: 'json',
			  cache: false,
			  data: $("#profile_edit_form").serialize(),
			}).done(function(res) {
				console.log(res);
					if(res.stat == 1){ 
						$('#AjaxLoader').hide();
						swal('Success!','Account Updated','success');	
						window.location.href = "page-profile.html";
					} 
			}).fail(function (jqXHR, textStatus) {
			    swal('Failed!','Could not Update','warning');
			    $('#AjaxLoader').hide();
			});
    
    	}

		function userOrders(logged_in_number) {
			if (logged_in_number) {
				$.ajax({
					url: orders_url,
					method: "POST",
					dataType: 'json',
					cache: false,
					data: { number: logged_in_number },
				}).done(function (res) {
					//IF SUCCESSFUL
					for (let item of res) {
						order_html = "<a href='page-order.html?id=" + item.booking_id + "&t=" + unixTime + "' class='default-link' title='Order'>";
						order_html += "<img src='images/empty.png' data-src='images/pictures/10t.jpg' class='preload-image round-small shadow-huge responsive-image' alt='img'>";
						order_html += "<div class='caption'>";
						order_html += "<h4 class='bottom-0 color-theme'>Delivery to " + item.to_location + " <small style='color:orange'>(Order)</small></h4>";
						order_html += "<p><strong>Type: My Order";
						order_html += "<br><strong>Category: " + item.category;
						order_html += "<br><strong>Price: GBP " + item.price + "</strong><br>Date: " + item.date_created + "</p>";
						order_html += "<div class='divider bottom-0'></div>";
						order_html += "</div>";
						order_html += "</a>";
						$("#order_html").append(order_html);
					}



				}).fail(function (jqXHR, textStatus) {
					swal('Something went wrong, please try again.');

				});
			} else {
				swal('Something went wrong, please try again.');
			}

		}

		function newOrders(logged_in_number) {
			if (logged_in_number) {
				$.ajax({
					url: new_orders_url,
					method: "POST",
					dataType: 'json',
					cache: false,
				}).done(function (res) {
					//IF SUCCESSFUL
					for (let item of res) {
						if (item.job_type == 0) {
							item.job_type = 'Bid Job';
						} else if (item.job_type == 1) {
							item.job_type = 'Regular Job';
						}
						var colour = "#19ea5a0d";
                        var price = Math.round(item.price * 1.20);
						order_html = "<a href='page-order.html?id=" + item.id + "' class='default-link' title='Order'>";
						order_html += "<img src='images/empty.png' data-src='images/pictures/10t.jpg' class='preload-image round-small shadow-huge responsive-image' alt='img'>";
						order_html += "<div class='caption' style='background: " + colour + ";padding:15px 10px 0px 10px'>";
						order_html += "<h4 class='bottom-0 color-theme'>Delivery to " + item.to_location + "<small style='color:green'> (New)</small></h4>";
						order_html += "<p><strong>Type: " + item.job_type;
						order_html += "<br><strong>Category: " + item.category;
						order_html += "<br><strong>Price: GBP " + price + "</strong><br>Date: " + item.date_created + "</p>";
						order_html += "<div class='divider bottom-0'></div>";
						order_html += "</div>";
						order_html += "</a>";

						$("#driver_html").append(order_html);

					}

					$('#driver_main_div').show();


				}).fail(function (jqXHR, textStatus) {
					swal('Something went wrong, please try again.');

				});
			} else {
				$("#driver_html").html();
				$('#driver_main_div').hide();
				swal('Something went wrong, please try again.');
			}

		}

		function acceptedJobs() {
			$('#driver_main_div').hide();
			$('#driver_secondary_div').show();
			$('#profile_accepted_jobs_button').attr('onclick', 'returnAcceptedJobs()');
			var logged_in_number = localStorage.getItem('JayLogisticGen');
			if (logged_in_number) {
				$.ajax({
					url: my_accepted_orders_url,
					method: "POST",
					dataType: 'json',
					cache: false,
					data: { 'number': logged_in_number }
				}).done(function (res) {
					//IF SUCCESSFUL
					for (let item of res) {
						if (item.job_type == 0) {
							item.job_type = 'Bid Job';
						} else if (item.job_type == 1) {
							item.job_type = 'Regular Job';
						}
						var colour = "white";
						var price = Math.round(item.price * 1.20);
						
						order_html = "<a href='page-order.html?id=" + item.booking_id + "' class='default-link' title='Order'>";
						order_html += "<img src='images/empty.png' data-src='images/pictures/10t.jpg' class='preload-image round-small shadow-huge responsive-image' alt='img'>";
						order_html += "<div class='caption' style='background: " + colour + ";padding:15px 10px 0px 10px'>";
						order_html += "<h4 class='bottom-0 color-theme'>Delivery to " + item.to_location + "<small style='color:green'> (New)</small></h4>";
						order_html += "<p><strong>Type: " + item.job_type;
						order_html += "<br><strong>Category: " + item.category;
						order_html += "<br><strong>Price: GBP " + price + "</strong><br>Date: " + item.date + "</p>";
						order_html += "<div class='divider bottom-0'></div>";
						order_html += "</div>";
						order_html += "</a>";

						$("#driver_secondary_html").append(order_html);

					}

					$('#driver_secondary_div').show();


				}).fail(function (jqXHR, textStatus) {
					swal('Something went wrong, please try again.');

				});
			} else {
				$("#driver_secondary_html").html();
				$('#driver_secondary_div').hide();
				swal('Something went wrong, please try again.');
			}

		}

		function returnAcceptedJobs() {
			$('#driver_secondary_div').hide();
			$('#driver_main_div').show();
			$('#profile_accepted_jobs_button').attr('onclick', 'acceptedJobs()');
		}

		/*$(document).on('submit', '#profile_edit_form', function(){

			//e.preventDefault();

			var ajax_base = "https://idispatch.easycreativesolutions.com/api/integration/v1/index.php/"   ;
			var profile_edit_url = ajax_base + "manager/profileEdit";

			var jform = new FormData();
			jform.append('profile_edit_first_name',$('#profile_edit_first_name').val());
			jform.append('profile_edit_last_name',$('#profile_edit_first_name').val());
			jform.append('profile_edit_number',$('#profile_number').html());
			jform.append('profile_edit_photo',$('#profile_edit_photo').get(0).files[0]); // Here's the important bit

			$.ajax({
				url: profile_edit_url,
				type: 'POST',
				data: jform,
				dataType: 'json',
				mimeType: 'multipart/form-data', // this too
				//contentType: false,
				cache: false,
				processData: false,
				success: function(data, status, jqXHR){
					swal('Hooray! All is well.');
					//console.log(data);
					//console.log(status);
					//console.log(jqXHR);

				},
				error: function(jqXHR,status,error){
					// Hopefully we should never reach here
					//console.log(jqXHR);
					//console.log(status);
					//console.log(error);
				}
			});
		}); */
	</script>
</body>
</html>